---
title: 实现分享到twitter、Facebook
date: 2023-10-15 00:55:48
permalink: /pages/7e3c89/
categories:
  - 技术
  - Electron
tags:
  - Electron
  - 设计模式
  - JavaScript
author: 
  name: huanggaoqing
  link: https://github.com/huanggaoqing
---
注意：whatsapp 分享时，字符串内不可包含?/&符号
## 静态分享
### 推特
静态网页模板，twitter会根据模板中的`mete`标签生成卡片
> twitter:url 要分享的链接 

> twitter:title 卡片标题 

> twitter:description 卡片简介 

> twitter:card 卡片类型 

> twitter:image 卡片的图片 
```html
<!--
 * @Author: huanggaoqing huanggaoqing@xender.com
 * @Date: 2023-09-25 13:31:13
 * @LastEditors: huanggaoqing huanggaoqing@xender.com
 * @LastEditTime: 2023-09-25 15:48:35
 * @FilePath: \xenderelectronc:\Users\33597\share_music.html
 * @Description: 
 * 
 * Copyright (c) 2023 by ${git_name_email}, All Rights Reserved. 
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <meta property="twitter:url" content="https://rr3---sn-i3belnls.googlevideo.com/videoplayback?expire=1695646334&ei=Hi4RZYX3KoCs1d8Pz6uvwAU&ip=137.59.102.134&id=o-ALVe_urk3I6uLQKdh4btgNTlV1EWhbaPPdZKXAOt2w2H&itag=22&source=youtube&requiressl=yes&mh=2P&mm=31%2C29&mn=sn-i3belnls%2Csn-i3b7knsl&ms=au%2Crdu&mv=m&mvi=3&pl=24&pcm2=no&gcr=hk&initcwndbps=351250&spc=UWF9fxLOtPtPqPPahZlxEsmUyXZAskk&vprv=1&svpuc=1&mime=video%2Fmp4&cnr=14&ratebypass=yes&dur=161.401&lmt=1681309568109945&mt=1695624316&fvip=1&fexp=24007246&c=ANDROID&txp=4532434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cpcm2%2Cgcr%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Ccnr%2Cratebypass%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAOBGhVzxBhNu5hsSf7yHTOaoWEWHPH3nVZnDaBVVAhPzAiBSmjbPgn8F3xKsuhea45g-8ynA3SCIm2f7engxlnYLTg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRQIhAKBIVdyd86Pw6q2PZQDfttWH8HDdjL4Z74g3w46352aEAiBBNsTBToYFg26B-9TUdWZB0TrYh3J4bLwIeOch5-vssA%3D%3D"/>
  <meta name="twitter:title" content="Yahritza Y Su Esencia & Grupo Frontera - Frágil (Official Video)"/>
  <meta name="twitter:description" content="Yahritza Y Su Esencia"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image" content="https://i.ytimg.com/vi/FJ0CRDzsuCs/sddefault.jpg?v=64306687"/>
</head>
<body>
  
</body>
</html>
<script></script>
```
调用twitter分享url
> text 文案
> url 静态模板url

```typescript
 shell.openExternal(`https://twitter.com/share?text=这是一个分享内容&url=https://www.musix-box.com/share_music.html`)
```
### Facebook
静态网页模板
> og:url 要分享的链接

> og:title 卡片标题

> og:description 卡片简介

> og:type 卡片类型

> og:image 卡片的图片

```html
<!--
 * @Author: huanggaoqing huanggaoqing@xender.com
 * @Date: 2023-09-25 13:31:13
 * @LastEditors: huanggaoqing huanggaoqing@xender.com
 * @LastEditTime: 2023-09-25 15:48:35
 * @FilePath: \xenderelectronc:\Users\33597\share_music.html
 * @Description: 
 * 
 * Copyright (c) 2023 by ${git_name_email}, All Rights Reserved. 
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <meta property="og:url" content="https://rr3---sn-i3belnls.googlevideo.com/videoplayback?expire=1695646334&ei=Hi4RZYX3KoCs1d8Pz6uvwAU&ip=137.59.102.134&id=o-ALVe_urk3I6uLQKdh4btgNTlV1EWhbaPPdZKXAOt2w2H&itag=22&source=youtube&requiressl=yes&mh=2P&mm=31%2C29&mn=sn-i3belnls%2Csn-i3b7knsl&ms=au%2Crdu&mv=m&mvi=3&pl=24&pcm2=no&gcr=hk&initcwndbps=351250&spc=UWF9fxLOtPtPqPPahZlxEsmUyXZAskk&vprv=1&svpuc=1&mime=video%2Fmp4&cnr=14&ratebypass=yes&dur=161.401&lmt=1681309568109945&mt=1695624316&fvip=1&fexp=24007246&c=ANDROID&txp=4532434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cpcm2%2Cgcr%2Cspc%2Cvprv%2Csvpuc%2Cmime%2Ccnr%2Cratebypass%2Cdur%2Clmt&sig=AOq0QJ8wRQIhAOBGhVzxBhNu5hsSf7yHTOaoWEWHPH3nVZnDaBVVAhPzAiBSmjbPgn8F3xKsuhea45g-8ynA3SCIm2f7engxlnYLTg%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AG3C_xAwRQIhAKBIVdyd86Pw6q2PZQDfttWH8HDdjL4Z74g3w46352aEAiBBNsTBToYFg26B-9TUdWZB0TrYh3J4bLwIeOch5-vssA%3D%3D"/>
  <meta property="og:title" content="Yahritza Y Su Esencia & Grupo Frontera - Frágil (Official Video)"/>
  <meta property="og:description" content="Yahritza Y Su Esencia"/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="https://i.ytimg.com/vi/FJ0CRDzsuCs/sddefault.jpg?v=64306687"/>
</head>
<body>
  
</body>
</html>
<script></script>
```
调用Facebook分享url
```typescript
shell.openExternal(`http://www.facebook.com/sharer.php?u=https://399e-137-59-102-134.ngrok-free.app/temp?meta=${encodeURIComponent(tempData)}`);
```
以上都是静态分享，分享内容不需要变化时适合用这种方式，如果需要动态内容，则需要后端接口配合
## 动态分享
传递要分享的数据给接口，接口根据数据动态的返回html类型的响应
go 动态模板生成接口demo
```go
package controller

import (
	"github.com/gin-gonic/gin"
	"log"
	"strings"
)

var Temp = temp{}

type temp struct{}

func (t *temp) Get(c *gin.Context) {
	metaStr := c.Query("meta")
	log.Println(metaStr)
	metaArr := strings.Split(metaStr, ",")
	log.Println("metaArr", metaArr)
	metaHtml := ""
	for i := 0; i < len(metaArr); i++ {
		metaHtml += "<meta property=\"" + metaArr[i] + "\" name=\"" + metaArr[i] + "\" content=\"" + metaArr[i+1] + "\"/>\n"
		i++
	}
	c.Writer.Header().Set("Content-Type", "text/html;charset=utf-8")
	c.Writer.WriteString("<!DOCTYPE html>\n" +
		"<html lang=\"en\">\n" +
		"<head>\n" +
		"<meta charset=\"UTF-8\">\n" +
		"<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">" +
		metaHtml +
		"</head>\n" +
		"<body>\n" +
		"<script type=\"text/javascript\">\n" +
		"</script>" +
		"</body>\n" +
		"</html>",
	)
}
```
前端调用
```typescript
const tempData = [
  "twitter:url", encodeURIComponent(song.url),
  "twitter:title", encodeURIComponent(songTitle),
  "twitter:description", encodeURIComponent(singer),
  "twitter:card", "summary_large_image",
  "twitter:image", encodeURIComponent(song.cover)
].join(",")
shell.openExternal(`https://twitter.com/share?text=这是一个分享内容&url=${encodeURIComponent('https://399e-137-59-102-134.ngrok-free.app/temp?meta=' + tempData)}`);
```
## electron中的实践
### 使用工厂模式生产对应的分享操作对象
分享操作主类
```typescript
import ipcServer from "../ipcServer"

export default class BaseShare {
  shareData = {}
  shareTempUrl = 'https://f576-137-59-102-104.ngrok-free.app/temp'
  playUrl = "https://www.youtube.com/embed/"
  constructor(data) {
    console.log({data})
    this.shareData = data
  }
  formatData(data) {
    return Object.entries(data)
      .map(([key, value]) => [
        key, 
        encodeURIComponent(value?.includes("http") ? value : value?.replace(/[?&]/g, ''))
      ])
      .flat(Infinity).join(",")
  }
  share(url, type) {
    ipcServer.send({
      type: "createShareWindow", 
      data: { type, url }
    })
  }
}
```
推特分享类，继承于主类
```typescript
import BaseShare from "./base";

export default class TwitterShare extends BaseShare {
  defaultContnet = "这是一首歌"
  constructor(data) {
    super(data);
  }
  formatData() {
    const json = {
      // "twitter:url": this.shareData.url,
      "twitter:title": this.shareData.title,
      "twitter:description": this.shareData.description,
      "twitter:image": this.shareData.image,
      "twitter:card": this.shareData.type ?? "summary_large_image",
      "og:id": this.shareData.id
    }
    return super.formatData(json)
  }
  share(content) {
    const url = `https://twitter.com/share?text=${(content ?? this.defaultContnet) + " " + (this.playUrl + this.shareData.id)}&url=${encodeURIComponent(this.shareTempUrl + "?meta=" + this.formatData() + "&ts=" + Date.now())}&ts=${Date.now()}`
    super.share(url, "twitter");
  }
}
```
facebook分享类，继承于主类
```typescript
import BaseShare from "./base";

export default class FaceBookShare extends BaseShare {
  constructor(data) {
    super(data);
  }
  formatData() {
    const json = {
      // "og:url": this.shareData.url,
      "og:title": this.shareData.title,
      "og:description": this.shareData.description,
      "og:image": this.shareData.image,
      "og:type": this.shareData.type ?? "website",
      "og:id": this.shareData.id
    }
    return super.formatData(json)
  }
  share() {
    const url = `http://www.facebook.com/sharer.php?u=${encodeURIComponent(this.shareTempUrl + "?meta=" + this.formatData() + "&ts=" + Date.now())}&ts=${Date.now()}`
    super.share(url, "facebook");
  }
}
```
whatsApp分享类，继承与主类
```typescript
import BaseShare from "./base";
import {shell} from "electron"

export default class WathsappShare extends BaseShare {
  defaultContnet = "这是一个分享内容"
  constructor(data) {
    super(data);
  }
  formatData() {
    const json = {
      // "og:url": this.shareData.url,
      "og:title": this.shareData.title,
      "og:description": this.shareData.description,
      "og:image": this.shareData.image,
      "og:type": this.shareData.type ?? "share",
      "og:id": this.shareData.id
    }
    return super.formatData(json)
  }
  async share(content) {
    try {
      const url = `whatsapp://send?text=${encodeURIComponent(this.shareTempUrl + "?meta=" + this.formatData() )}`
      await shell.openExternal(url)
    } catch (error) {
      const webUrl = `https://api.whatsapp.com/send?text=${this.defaultContnet + " " + encodeURIComponent(this.shareTempUrl + "?meta=" + this.formatData() )}`
      super.share(webUrl, "whatsapp")
    };
  }
}
```
入口文件，根据传入的type，获取到对应的分享类进行操作
```typescript
import FaceBookShare from "./facebook";
import TwitterShare from "./twitter";
import WathsappShare from "./whatsapp";

const shareMap = new Map([
  ['facebook', FaceBookShare],
  ['twitter', TwitterShare],
  ['whatsapp', WathsappShare],
])

export default function shareController(type, data) {
  if (!shareMap.has(type)) {
    throw new Error(`share type ${type} not found`)
  }
  return new (shareMap.get(type))(data)
}

```
分享时调用
```typescript
function handleShare(target) {
  const {song, songTitle, singer} = props
  const tempData = {
    "url": song.url,
    "title": songTitle ?? song.title,
    "description": singer ?? song.artist,
    "image": song.cover,
    "id": song.th_id
  }
  shareController(target, tempData).share()
}
```
### 主线程接受消息，打开新的窗口进行分享操作
```typescript
async function createShareWindow(data) {
  const {url, type} = data
  console.log({url})
  const shareWin = new BrowserWindow({
    width: type === 'whatsapp' ? 1000 : 600,
    height: type === 'whatsapp' ? 1000 : 600,
    backgroundColor: '#fff',
    webPreferences: {
      webviewTag: true,
      webSecurity: false,
      contextIsolation: !process.env.ELECTRON_NODE_INTEGRATION,
    },
    show: true
  })
  shareWin.loadURL(url, {userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.215 Safari/537.36'})
}
```
